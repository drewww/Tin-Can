<html>
<head>
<meta name="viewport" content="width=300" />
	<script type ="text/javascript" src = "http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  <script src="../static/js/jquery.iphoneui.js" type="text/javascript" charset="utf-8"></script>

	<script type ="text/javascript">
	var itemCounter = 0; // number of items ever created
	var items = [];  // array of agenda items
	var currentItem; // current item's id - string
	var lastClicked = 'item0';
	var currentClicked; // object

	//Turn on drag and drop sorting and constrain to y axis	
		// $(function() {
		// 	$("#container").sortable({placeholder: 'ui-state-highlight',
		// 	axis: 'y'});
		// 
		// });
	
		// $(document).ready(function(){
		// 	template = $("#doneTemplate");
		// 	itemList = $("#container");
		// 	$("#newItem").hide();
		// })
		
		

	
	// visibility toggle for new item textbox input
		function add(){
			newItem = $("#newItem")[0];
			if (newItem.style.display!="block"){
				newItem.style.display="block";
			}
			else{
				$("#itemInput").value="";
				newItem.style.display="none";
			}

		}
		
		
	//crash test dummy item
		// function makeCurrentItem() {
		// 	templateCurrent = $("#currentTemplate");
		// 	itemList = $("#container");
		// 	clone = templateCurrent.clone();
		// 	itemList.append(clone);
		// 	clone.show();
		// 	itemCounter = itemCounter + 1;
		// 	clone[0].id = 'item' + itemCounter;
		// 	items.push(clone[0].id);
		// 	// $('.drag').addTouch();
		// 	
		// 	clone.click(function (e) {
		// 		template = $("#extraOptionsTemplate");
		// 		currentClicked = $(this);
		// 		if (lastClicked == currentClicked.get(0).id){
		// 			template.hide();
		// 			lastClicked = 'item0';
		// 			// currentClicked[0].style.height = "40px";
		// 		}
		// 		else{
		// 			lastClicked = currentClicked.get(0).id;
		// 			$(this).append(template);
		// 			// currentClicked[0].style.height = "60px";
		// 			template.show();
		// 		}
		// 	})	
		// }

	//crash test dummy item		
		// function makeDoneItem(doneItem) {
		// 	templateDone = $("#doneTemplate");
		// 	itemList = $("#container");
		// 	clone = templateDone.clone();
		// 	itemList.append(clone);
		// 	clone.show();
		// 	$('.drag').addTouch();	
		// 	clone.click(function (e) {
		// 		template = $("#extraOptionsTemplate");
		// 		currentClicked = $(this);
		// 		currentClicked.doneItem=true;
		// 		if (lastClicked == currentClicked.get(0).id){
		// 			template.hide();
		// 			lastClicked = 'item0';
		// 			currentClicked[0].style.height = "40px";
		// 		}
		// 		else{
		// 			lastClicked = currentClicked.get(0).id;
		// 			$(this).append(template);
		// 			currentClicked[0].style.height = "60px";
		// 			template.show();
		// 		}
		// 	})	
		// }
	
	//grab input from textbox and generate item in list
		function makeFutureItem(name) {
			var check = document.getElementById("futureCheck");
			templateFuture = $("#futureTemplate");
			itemList = $("#container");
			newItem=$("#itemInput")[0].value;  // assign user input in textbox to newItem
			check.style.visibility = "hidden";
			clone = templateFuture.clone();
			clone.find("span").html(newItem);
			itemList.append(clone);
			clone.show();
			itemCounter = itemCounter + 1;
			clone[0].id = 'item' + itemCounter;  // generate unique id's for every item based on how many items have ever been created
			items.push(clone[0].id);
			// $('.drag').addTouch();
			$("#itemInput")[0].value="";
			$("#newItem")[0].style.display="none"
			updateCurrent();

			clone.click(function (e) {
				template = $("#extraOptionsTemplate");
				currentClicked = $(this);
				console.log('items: ' + items);
				console.log('current clicked is ' + items.indexOf(currentClicked[0].id));
				
				// toggle showing the extra options
				// if an item has been clicked on an even number of times (i.e. twice), hide the options
				// otherwise show the options when clicked an odd number of times (i.e. first click)
				if (lastClicked == currentClicked.get(0).id){
					template.hide();
					lastClicked = 'item0';
					currentClicked[0].style.height = "40px";
				}
				else{
					lastClicked = currentClicked.get(0).id;
					$(this).append(template);
					currentClicked[0].style.height = "60px";
					
					// if the current item is clicked, show the "Done" button, otherwise hide it
					if (currentClicked[0].id == currentItem) {
						$("#doneButton").show();
						template.show();
					}
					else{
						$("#doneButton").hide()
						template.show();
					}
				}
			})				
		}
		
		function deleteItem() {
		//	if (currentClicked.doneItem){}
	
				template = $("#extraOptionsTemplate");
				template.hide();
				$("#container").append(template);
				currentIndex = items.indexOf(currentClicked[0].id);
				items.splice(currentIndex, 1);
				currentClicked.remove();
				
				// if user deleted the current item on the agenda, update currentItem to be next on the agenda
				if (currentClicked[0].id == currentItem) {
					currentItem = items[currentIndex];
				}
				
				updateCurrent();	
			
			
		}
		
		function queueNext() {
			console.log('current ITEM is ' + currentItem);
			console.log(currentItem);
			console.log(currentClicked);
			
			// update the items array to reflect the new order of items
			// remove the item to be queued from array, set as temp, then insert in the new position
			clickedIndex = items.indexOf(currentClicked[0].id);
			temp = items[clickedIndex];
			items.splice(clickedIndex, 1);
			currentIndex = items.indexOf(currentItem);
			tempindex = currentIndex + 1;
			items.splice(tempindex,0,temp);
			
			console.log('updated items list: ');
			console.log(items);			
			(currentClicked).insertAfter($("#"+currentItem));
			// document.getElementById(currentItem).after(currentClicked);
			
		}
		
		function updateCurrent() { 
			console.log('length is ' + items.length);
			
			// if there's only one item left, make that the current item (mainly for the initial case when first adding items to agenda)
			if (items.length == 1) {
				console.log('length is 1 and item is ' + items[0]);
				currentItem = items[0];
				document.getElementById(currentItem).style.background = "#0000FF";
			}
			else{
				 document.getElementById(currentItem).style.background = "#0000FF";
				//$("#"+currentItem).style.background = "0000FF";
			}
		}
			
	// removes item marked done from the items array, colors it grey, and sets the next item in agenda as the current item
		function itemDone() {
			console.log($("#"+currentItem));
			console.log(currentClicked);
			currentIndex = items.indexOf(currentClicked[0].id);
			document.getElementById(currentItem).style.background = "#C0C0C0";
			items.splice(currentIndex, 1);
			currentItem = items[currentIndex];
			updateCurrent();
		
		}
	</script>


	<style type="text/css">
	
	#container{
		font-family: Helvetica, sans-serif;
		margin: 0px;
		padding: 0px;
	}
	
	#border{
		border:1px solid;
		margin: 0px;
		padding: 0px;
		height: 480px;
		width: 320px;
	}
	#container > div{
		height: 40px;
		border: 1px solid;
		margin: .07em;
		padding: 0px;
	}
	
	.delete{
		float: left;
		margin-top: 2px;
	}
	
	.check{
		height: 30px;
		width: 30px;
		margin-top: 5px;
		margin-right: 5px;
	}
	
	.drag{
		float: right;
	}
	
	#header{
		text-align: center;
	}
	
	.template{
		display: none;
	}
	
	#newItem{
		display:none;
	}

	#extraOptionsTemplate{
		display:none;
	}
	</style>
</head>
<body>
<div id="border">
	
	<div id="header">Edit 
		<input type="button" value="Done" onclick="itemDone()">
		<input type="button" value="Current" onclick="makeCurrentItem()">
		<input type="button" value="Add" onclick="add()"> </div>
	
	<div id="newItem">
		<input type="text" name="item" value="" id="itemInput" class="textbox">
		<button type = "submit" onclick="makeFutureItem();">Submit</button>
	</div>		
	
<div id="container">
	
			
	<div id="currentTemplate" class="template">
		<img src="{{ static_url("images/delete.png")}}" class="delete">
		--->
		<span id="text">current Item</span>
		<img src ="{{ static_url("images/drag.png")}}" class="drag">		
	</div>

	<div id="doneTemplate" class="template">
		<img src="{{ static_url("images/delete.png")}}" class="delete">
		<img src="{{ static_url("images/accept.png")}}" class="check">
		<span id="text">Done Item</span>
		<img src ="{{ static_url("images/drag.png")}}" class="drag">		
	</div>	

	<div id="futureTemplate" class="template">
		<img src="{{ static_url("images/delete.png")}}" class="delete">
		<img src="{{ static_url("images/accept.png")}}" class="check" id="futureCheck">
		<span id="text"></span>
		<img src ="{{ static_url("images/drag.png")}}" class="drag">		
	</div>
	
	<div id="extraOptionsTemplate">
		<button type="submit" onclick="deleteItem();">Delete</button>
		<button type="submit" onclick="queueNext();">Queue Next</button>
		<button type="submit" id="doneButton" onclick="itemDone();"> Done</button>
	</div>
</div>
Done

</div>
</body>
</html>