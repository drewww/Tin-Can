<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta name="viewport" content="width=320, user-scalable=yes">
	<title>login</title>
<script type ="text/javascript" src = "http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
<script type="text/javascript" charset="utf-8">
	var listElement;
	var nameTemplate;
	var names = ["asdf", "asdf325", "omgomgomg"];
	var nameElements = new Array();
	var select=true; //keeps track of whether you can select usernames
	
	$(document).ready(function(){
		listElement = $("#usernamelist");
		nameTemplate = $("#template");
		
		nameTemplate.hide();
		
		//generates initial username list
		for (var name in names){
			var newNameElement = createNewItem(names[name]);
			listElement.append(newNameElement);
			nameElements.push(newNameElement);
		}
		
		$("#searchname").keyup(searchForUser);
	});
	
	function createNewItem(name){
		var newNameElement = nameTemplate.clone();
		newNameElement.find("div").html(name);
		newNameElement.show();
		return newNameElement;
	}
	
	//hide all elements. go through names. if a name is in list, show the name element.
	function displayList(list){
		$(".name").hide();
		for (var name in names){
			if ($.inArray(names[name],list)>=0){
				nameElements[name].show();
			}
		}
	}
	
	function toggleAdd(){
		clearSearch();
		var addName=$("#newuser")[0];
		$("#searchtype").hide();
		
		if (addName.style.display!="block"){
			addName.style.display="block";
			$("#newname").focus();
			select=false;
		}
		else{
			$("#newname")[0].value="";
			addName.style.display="none";
			select=true;
		}
	}
	
	function submitNewUser(){
		var newName=$("#newname")[0].value;
		if (newName!=""){
			$("#newname")[0].value="";
			var newNameElement = createNewItem(newName);
			names.splice(0,0,newName);
			newNameElement.insertAfter("#template");
			nameElements.splice(0,0,newNameElement);
			toggleAdd();
			displayList(names);
			selectUser(newNameElement[0]);
		}
	}
	
	function toggleSearch(){
		select=true;
		$(".name").css("background","white");
		search=$("#searchtype")[0];
		$("#newuser").hide();
		
		if (search.style.display!="block"){
			search.style.display="block";
			$("#searchname").focus();
		}
		else{
			$("#searchname")[0].value="";
			search.style.display="none";
			displayList(names);
		}
	}
	
	function searchForUser(){
		$(".name").css("background","white");
		searchName=$("#searchname")[0].value.toUpperCase();
		var newList = new Array();
		for (var name in names){
			if (names[name].substring(0,searchName.length).toUpperCase()==searchName){
				newList.push(names[name]);
			}
		}
		displayList(newList);
	}
	
	function clearSearch(){
		$(".name").css("background","white");
		$("#searchname")[0].value="";
		displayList(names);
		$("#searchname").focus();
	}
	
	//highlights username or closes add-user-bar
	function selectUser(item){
		$(".name").css("background","white");
		if (select){
			item.style.background="#00CCFF";
		}
		else{
			toggleAdd();
		}
	}
	
</script>

<style type="text/css" media="screen">
	body{
		margin:0px;
	}
	div{
		margin:0px;
	}
	ul{
		border:solid;
		width:320px;
		list-style-type:none;
		padding:0px;
		margin:0px;
	}
	li{
		border-bottom: 1px solid black;
	}
	.line{
		width:320px;
		height:50px;
		margin:none;
		padding:none;
		clear:both;
		position:relative;
	}
	.status{
		width:25px;
		float:left;
		padding-top:12px;
		padding-bottom:12px;
	}
	.next{
		width:25px;
		float:right;
		padding-top:11px;
		padding-bottom:11px;
	}
	.icon{
		width:40px;
		float:left;
		padding-top:5px;
		padding-bottom:5px;
	}
	.username{
		width:230px;
		float:left;
		font-family:"Arial",sans-serif;
		padding-top:15px;
		padding-bottom:15px;
	}
	#add{
		width:100px;
		text-align:right;
		float:left;
		padding-top:10px;
		padding-bottom:10px;
	}
	#title{
		width:120px;
		text-align:center;
		font-size:20px;
		float:left;
		font-family:"Arial",sans-serif;
		padding-top:15px;
		padding-bottom:15px;
	}
	#search{
		width:100px;
		float:right;
		padding-top:10px;
		padding-bottom:10px;
	}
	#header{
		width:320px;
		height:50px;
		margin:none;
		padding:none;
		clear:both;
		position:relative;
		border-top:solid;
		border-left:solid;
		border-right:solid;
	}
	.textbox{
		height:25px;
		margin-top:7px;
		margin-bottom:7px;
		margin-left:5px;
		width:150px;
		font-size:17px;
	}
	#newuser{
		display:none;
	}
	#searchtype{
		display:none;
	}
</style>
</head>

<body>
	<div>
	<div id="header">
		<div id = "add"><button id="addbutton" onclick = "toggleAdd();">Add</button></div>
		<div id ="title">Users</div>
		<div id ="search"><button id="searchbutton" onclick = "toggleSearch();">Find</button></div>
	</div>
	<ul id = "usernamelist">
		<li id = "newuser" class = "line">
			<label for="name"></label><input type="text" name="name" value="" id="newname" class="textbox">
			<button type = "submit" onclick="submitNewUser();">Create!</button>
		</li>
		<li id = "searchtype" class = "line">
			<label for="name"></label><input type="text" name="name" value="" id="searchname" class="textbox">
			<button id = "clearsearch" onclick="clearSearch();">x</button>
			<button id = "cancelsearch" onclick="toggleSearch();">Cancel</button>
		</li>
		<li id ="template" class="line name" onclick = "selectUser(this);">
			<img class = "status" src = "{{ static_url("images/online.png")}}">
			<div class = "username"></div>
			<img class = "icon" src = "{{ static_url("images/icon.png")}}">
			<img class = "next" src = "{{ static_url("images/next.png")}}">
		</li>
	</ul>
	</div>
</body>
</html>
